<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
Project Atomic News &mdash;
Project Atomic
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='Project Atomic. Sponsored by Red Hat, Inc.' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>
<link href='/blog/feed.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/blog/feed.xml' rel='alternate' title='Project Atomic' type='application/atom+xml'>
<link href="/stylesheets/application.css?1633620577" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1633620578" rel="stylesheet" type="text/css" media="print" />
<div class="alert alert-danger text-center">
<h2> Project Atomic is now sunset</h2>
<p>
The Atomic Host platform is now replaced by <a href="https://coreos.fedoraproject.org">CoreOS</a>.
Users of Atomic Host are encouraged to join the CoreOS community on the <a href="https://github.com/coreos/fedora-coreos-tracker#communication-channels-for-fedora-coreos">Fedora CoreOS communication channels</a>.
</p>
<p>
The documentation contained below and throughout this site has been retained for historical purposes, but can no longer be guaranteed to be accurate.
</p>
</div>

</head>
<body class=' blog blog_page-63 blog_page-63_index source-haml'>
<section class='container' id='page-wrap'>
<div class='row'>
<div class='col-md-3 col-lg-2' id='sidebar'>
<div id='nav-primary'>
<nav class='navbar navbar-default' role='navigation'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-ex1-collapse' data-toggle='collapse'>
<span class='sr-only'>
Toggle navigation
</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
<a class='navbar-brand' href='/'>
Project Atomic
</a>
</div>
<div class='collapse navbar-collapse navbar-ex1-collapse'>
<ul class='nav navbar-nav'>
<li><a class="get-started" href="/download">Get Started</a></li>
<li><a class="documentation" href="/docs">Documentation</a></li>
<li><a class="developer-community" href="/community">Developer Community</a></li>
<li><a class="talks" href="/community/talks">Talks</a></li>
<li><a class="on-github" href="https://github.com/projectatomic/">On GitHub</a></li>
<li><a class="blog" href="/blog">Blog</a></li>
<li><a class="twitter" href="http://www.twitter.com/projectatomic">Twitter</a></li>
<li><a class="rss" href="../feed.xml">RSS</a></li>
</ul>
</div>
</nav>

</div>

</div>
<section class='col-lg-10 col-md-9 container' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<section class='blog-post-page row'>
<div class='col-md-12'>
<section class='blog-archive'>
<h1>Project News</h1>
<section class='articles'>
<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
<a href="/blog/2014/05/the-difference-between-project-atomic-and-atomic-hosts/">The Difference Between Project Atomic and Atomic Hosts</a>
</h2>
<p class='post-meta'>
<span class='byline'>
by
</span>
<span class='author vcard'>
<a href="/blog/author/jzb-lars/">Joe Brockmeier, Lars Herrmann</a>
</span>
&ndash;
<time class='published' datetime='2014-05-15T20:18:00Z'>
Thursday 15 May 2014
</time>
</p>
</header>
<section class='post-content entry-content'>
<p>Project Atomic has been getting a great deal of attention since it was announced at Red Hat Summit this April. We saw a lot of enthusiasm at Summit for the concept of Atomic Hosts that are focused on running Docker containers, but still built from a well-known, well-tested distribution. </p>

<p>One thing we&rsquo;ve seen, though, is a little confusion about the separation between Project Atomic and <strong>Atomic Hosts</strong>. Project Atomic, itself, does not produce Linux OS releases. Instead, those will come from CentOS, Fedora, Red Hat, and potentially others.</p>

<h3>The Value of Upstream First</h3>

<p>Red Hat&rsquo;s philosophy on driving technology innovation in upstream communities that then gets into the hand of customers in the form of robust products can be summarized as <q>upstream first.</q> </p>

<p>Over the last decade this philosophy has spurred rapid technology innovation, fueled by user needs, that is ultimately delivered in supportable enterprise-grade products. This ensures that the best-suited technical solution is generated in the open source development community. </p>

<p>Project Atomic is designed around this philosophy. Not only does it strive to be a community for the technology behind optimized container hosts, it is also designed to feed requirements back into the respective upstream communities. By leaving the downstream release of Atomic Hosts to the Fedora community, CentOS community and Red Hat, it can focus on driving technology innovation.</p>

<h3>The Atomic Family</h3>

<p>This is important to understand, because each of the offerings will differ in important ways, though they&rsquo;ll also be very similar.</p>

<p>First, the release cycle will vary depending on where you&rsquo;re getting your host. Release cycles are defined as a balance between the desire to deliver new features and enhancements and the ability of the target users to consume new releases. The release cycle for Red Hat Enterprise Linux Atomic Host (RHEL Atomic Host) will not match up with the release cycle for the Atomic offering from the Fedora Project. The RHEL Atomic Host release cycle will be suited for enterprise deployments, while the Fedora cycle will be more attuned to those doing leading edge development and testing newer technologies.</p>

<p>It also goes without saying that the actual content of the releases will also differ. Fedora&rsquo;s offering will likely move faster, include newer and consequently less proven and robust technologies. These technologies may then work their way into future productized versions of RHEL Atomic Host, in the same way that Fedora feeds into future versions of Red Hat Enterprise Linux. </p>

<p>How Fedora and CentOS Atomic offerings evolve is also up to the respective communities. The <a href="https://fedoraproject.org/wiki/Cloud_SI">Fedora Cloud Special Interest Group</a> (SIG) is still discussing exactly what packages will be included, how frequently releases will be generated, what type of images should be produced, and more. There&rsquo;s plenty of room for the larger community to be involved in those projects, and we welcome participation. (See the <a href="https://fedoraproject.org/wiki/Cloud_SIG">Fedora wiki</a> for more info, or join us on IRC (#fedora-cloud) on Freenode, or join the mailing list.)</p>

<p>Similar community discussion is happening in the <a href="http://wiki.centos.org/GettingHelp/ListInfo">CentOS community</a> to land the optimal balance for their users. </p>

<h3>The Role of Project Atomic</h3>

<p>Project Atomic gives the larger community a place and tools to collaborate on related technologies that are vital to Atomic Hosts, such as SELinux (<a href="http://www.projectatomic.io/docs/docker-and-selinux/">http://www.projectatomic.io/docs/docker-and-selinux/</a>) to secure your containers, GearD (<a href="http://www.projectatomic.io/docs/geard/">http://www.projectatomic.io/docs/geard/</a>) for container wiring and systemd integration and Cockpit (<a href="http://www.projectatomic.io/docs/cockpit/">http://www.projectatomic.io/docs/cockpit/</a>) to help manage containers. It also gives users of the various releases a forum to solve problems on using the technologies, keep tabs on important developments, and to participate in developing the technologies. </p>

<p>The project will also serve to disseminate news about Atomic Host distributions and important changes in the upstreams like Docker, rpm-ostree, SELinux, and others. So be sure to keep an eye on this site and <a href="http://twitter.com/projectatomic">@projectatomic</a>.</p>

<a class="more-link view-article" href="/blog/2014/05/the-difference-between-project-atomic-and-atomic-hosts/">View article &raquo;</a>
</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'>
<li><a href="/blog/tag/atomic/">Atomic</a></li>
<li><a href="/blog/tag/centos/">CentOS</a></li>
<li><a href="/blog/tag/docker/">Docker</a></li>
<li><a href="/blog/tag/enterprise/">Enterprise</a></li>
<li><a href="/blog/tag/fedora/">Fedora</a></li>
<li><a href="/blog/tag/rhel/">RHEL</a></li>
</ul>
</div>
</footer>
</article>

<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
<a href="/blog/2014/05/moving-an-rhscl-app-to-docker-on-atomic/">Moving an RHSCL app to Docker on Atomic</a>
</h2>
<p class='post-meta'>
<span class='byline'>
by
</span>
<span class='author vcard'>
<a href="/blog/author/jzb/">Joe Brockmeier</a>
</span>
&ndash;
<time class='published' datetime='2014-05-09T19:44:00Z'>
Friday  9 May 2014
</time>
</p>
</header>
<section class='post-content entry-content'>
<p>As I&rsquo;ve mentioned a number of times when I&rsquo;ve spoken about <a href="http://softwarecollections.org">Software Collections</a> (SCLs), containers and SCLs are <em>not</em> mutually exclusive. In fact, SCLs promise to be really important for a lot of developers in building containers for production. </p>

<p>Langdon White has written up a <a href="http://developerblog.redhat.com/2014/05/07/moving-app-to-docker-on-atomic/">great post on how to move an RHSCL app to Docker</a> using an Atomic host:</p>

<blockquote>
<p>Ok, now that Atomic is installed, I need to go make a container. After a few fits and starts, mostly related to pathing issues while using the <q>RUN</q> command, I got a decent Dockerfile working. You <q>run</q> this file by using the &lsquo;docker build&rsquo; command. Later, you <q>make the app go</q> with the &#39;docker run&rsquo; command. </p>
</blockquote>

<p>Check out the rest of Langdon&rsquo;s post on <a href="http://developerblog.redhat.com/2014/05/07/moving-app-to-docker-on-atomic/">the Red Hat Developer Blog</a>.</p>

<a class="more-link view-article" href="/blog/2014/05/moving-an-rhscl-app-to-docker-on-atomic/">View article &raquo;</a>
</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'>
<li><a href="/blog/tag/scl/">SCL</a></li>
<li><a href="/blog/tag/software-collections/">Software Collections</a></li>
<li><a href="/blog/tag/softwarecollections-org/">SoftwareCollections.org</a></li>
</ul>
</div>
</footer>
</article>

<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
<a href="/blog/2014/05/running-systemd-in-a-docker-container/">Running systemd in a Docker Container</a>
</h2>
<p class='post-meta'>
<span class='byline'>
by
</span>
<span class='author vcard'>
<a href="/blog/author/jzb/">Joe Brockmeier</a>
</span>
&ndash;
<time class='published' datetime='2014-05-06T19:50:00Z'>
Tuesday  6 May 2014
</time>
</p>
</header>
<section class='post-content entry-content'>
<p>Ever wondered if you can get <code>systemd</code> running in a Docker container? Apparently Dan Walsh did, <a href="http://rhatdan.wordpress.com/2014/04/30/running-systemd-within-a-docker-container/">and spent some time getting it to work</a>.</p>

<blockquote>
<p>While working with Docker, I looked at the great work that Scott Collier was doing for getting services to run within a container.  Scott provides the fedora-dockerfiles package in docker with lots of “Dockerfile” examples. You can build Docker images by running “docker build” on these examples.</p>

<p>It seemed a little difficult, and wondered if getting systemd to run within a docker container, as I did with virt-sandbox-service, might make this simpler.</p>

<p>The Docker Model suggests that it is better to run a single service within a container.  If you wanted to build an application that required an Apache service and a MariaDB database, you should generate two different containers.   Some people insist on running multiple services within a container, and for this Docker suggested using the supervisord tool.  In RHEL we do not want to support supervisord, since it is written in Python, and do not want to pull a Python requirement into containers, and it is just a package used to monitor multiple services.  We already have a tool for monitoring multiple services called systemd.</p>
</blockquote>

<p>After a little trial and error, Dan got <code>systemd</code> working within a container on Fedora Rawhide, and expects it will work on Fedora 20 or RHEL 7 (when it&rsquo;s released). Give it a spin and <a href="http://rhatdan.wordpress.com/2014/04/30/running-systemd-within-a-docker-container/">let Dan know</a> how it works out for you.</p>

<a class="more-link view-article" href="/blog/2014/05/running-systemd-in-a-docker-container/">View article &raquo;</a>
</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'>
<li><a href="/blog/tag/cgroups/">cgroups</a></li>
<li><a href="/blog/tag/docker/">Docker</a></li>
<li><a href="/blog/tag/systemd/">systemd</a></li>
</ul>
</div>
</footer>
</article>

<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
<a href="/blog/2014/04/why-project-atomic/">Why Project Atomic?</a>
</h2>
<p class='post-meta'>
<span class='byline'>
by
</span>
<span class='author vcard'>
<a href="/blog/author/jzb/">Joe Brockmeier</a>
</span>
&ndash;
<time class='published' datetime='2014-04-16T17:25:00Z'>
Wednesday 16 April 2014
</time>
</p>
</header>
<section class='post-content entry-content'>
<p>The response to the Project Atomic launch has been overwhelming, and we&rsquo;re getting a lot of interest &ndash; and <a href="http://ask.projectatomic.io/en/questions/">questions</a> &ndash; about the project. In particular, many developers and admins want to know what sets Atomic apart from other Docker-focused offerings. </p>

<h3>A Distribution You Know and Trust</h3>

<p>One of the most compelling reasons for users of Fedora, CentOS, and Red Hat Enterprise Linux is that the Atomic host <em>brings the advantages of its base distribution</em>. </p>

<p>The packages are used to create an Atomic host bring the same advantages of the base distribution &ndash; you get the base features you&rsquo;d get with Fedora, CentOS, or RHEL (like SELinux, filesystem options, kernel tuning, and so forth). For RHEL customers, there&rsquo;s also the certification and training ecosystem you can rely on with Red Hat Enterprise Linux Atomic Host. </p>

<p>Tools like Anaconda, which many admins and developers depend on for deploying and managing systems, will be available with Atomic hosts. This means Kickstart support, for instance, carries forward with Atomic hosts.</p>

<h3>RPM Ecosystem</h3>

<p>Because Atomic hosts are built with rpm-ostree, they benefit from the RPM ecosystem and will let projects and vendors distribute updates concurrently with the mainline distribution. So, for instance, when Fedora sends out an OpenSSL update the same RPMs used to deliver the update to users of the traditional Fedora distribution can be quickly used to generate a new tree for Atomic users. </p>

<p>What&rsquo;s more, users will have the ability to roll back updates when necessary.</p>

<p>Want to roll your own custom Atomic hosts? Want to do something crazy like including GNU Emacs on the Atomic Host? You can use the rpm-ostree technology to do just that.</p>

<h3>GearD Support</h3>

<p>A major feature that will be integrated into Atomic hosts is <a href="http://openshift.github.io/geard/">GearD</a>, technology we&rsquo;ve pulled in from the OpenShift Origin project, which helps bind systemd and Docker to make containers easier to configure and manage. </p>

<h3>Cockpit Support</h3>

<p>Finally, Atomic hosts feature <a href="http://cockpit-project.org/">Cockpit</a>, a server manager that makes managing hosts, services, and containers easier. Cockpit is also coming to Fedora, CentOS, and RHEL, giving you another standard tool to work with for all of your systems.</p>

<h3>We&rsquo;re Open</h3>

<p>We are excited to show this work to the larger community, and to invite you to not only use Atomic &ndash; but we&rsquo;re also excited about working with the larger community to make Atomic hosts the best way to run Docker containers. Join our <a href="http://www.projectatomic.io/community/">developer community</a>, and let&rsquo;s make Atomic even better.</p>

<a class="more-link view-article" href="/blog/2014/04/why-project-atomic/">View article &raquo;</a>
</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'>
<li><a href="/blog/tag/atomic/">Atomic</a></li>
<li><a href="/blog/tag/cockpit/">Cockpit</a></li>
<li><a href="/blog/tag/geard/">GearD</a></li>
<li><a href="/blog/tag/kernel/">Kernel</a></li>
<li><a href="/blog/tag/selinux/">SELinux</a></li>
</ul>
</div>
</footer>
</article>

<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
<a href="/blog/2014/04/build-your-own-atomic-host-on-fedora-20/">Build Your Own Atomic Host on Fedora 20</a>
</h2>
<p class='post-meta'>
<span class='byline'>
by
</span>
<span class='author vcard'>
<a href="/blog/author/jbrooks/">Jason Brooks</a>
</span>
&ndash;
<time class='published' datetime='2014-04-16T14:01:00Z'>
Wednesday 16 April 2014
</time>
</p>
</header>
<section class='post-content entry-content'>
<p>The application as shipping container metaphor behind the <a href="https://www.docker.io/">Docker project&rsquo;s</a> name and logo paints an attractive picture for developers: spawn a container on your local machine, fill it with code, and then ship it off to your far-flung users.</p>

<p>While the app is where the action happens, I can&rsquo;t help but wonder what sort of ships await our containers when they arrive at the dock. No matter how well you&rsquo;ve crafted or carefully you&rsquo;ve packed your cargo, your application will only make it as far as its ship can take it.</p>

<p>Maybe the best thing about Project Atomic is the way it addresses both the shipping container and the ship itself, the former with Docker, and the latter with an intriguing (if less catchily-named) project called rpm-ostree. </p>

<p>We can use rpm-ostree to take a set of packages from one of our friendly neighborhood RPM-based Linux distributions, assemble it into a <q>just-enough</q> OS image, and then deploy and manage hosts based on that image in a manner that more closely matches the container model than do traditional OSes.</p>

<p>Project Atomic has kicked off with a host image, based on Fedora 20, that you can download and use right away, but if you&rsquo;re like me, you&rsquo;re looking for a way to build your own customized Atomic images. Here&rsquo;s how to do it:</p>

<h3>The Build Machine</h3>

<p>For a build machine, I&rsquo;ve been using a Fedora 20 minimal install with all updates. There are various configuration tweaks required on your build host for now, so it&rsquo;s probably that you set aside a separate machine for this &ndash; I run it on a virtual machine.</p>

<h3>Software Repositories</h3>

<p>We have to install rpm-ostree, and some complementary packages, on our build host, as well as make available to our host the packages we intend to include in our Atomic image.</p>

<p>I&rsquo;ve assembled the required packages for F20 in this <a href="http://copr.fedoraproject.org/coprs/jasonbrooks/rpm-ostree/">Copr repository</a>. (If you&rsquo;re not familiar with Copr, you can <a href="https://fedorahosted.org/copr/">learn about it here</a>, but, more or less, it&rsquo;s like Personal Package Archives for Fedora/CentOS.</p>
<pre class="highlight plaintext"><code>cat &gt; /etc/yum.repos.d/jasonbrooks-rpm-ostree.repo &lt;&lt; EOF&#x000A;[rpm-ostree]&#x000A;name=Copr repo for rpm-ostree owned by walters&#x000A;baseurl=http://copr-be.cloud.fedoraproject.org/results/jasonbrooks/rpm-ostree/fedora-20-x86_64/ &#x000A;gpgcheck=0&#x000A;enabled=0&#x000A;metadata_expire=1h&#x000A;EOF&#x000A;</code></pre>

<p>While an F20 build host already knows about F20 packages, rpm-ostree gets hung up on the <code>$releasever</code> variable that appears in the Fedora repo files by default. I have a separate repo file that pulls together the fedora, fedora-updates and fedora-updates-testing repos into a single repo file, with the release version hard-coded:</p>
<pre class="highlight plaintext"><code>cat &gt; /etc/yum.repos.d/fedora-20-atomic.repo &lt;&lt; EOF&#x000A;[fedora-20]&#x000A;name=Fedora 20 x86_64&#x000A;metalink=https://mirrors.fedoraproject.org/metalink?repo=fedora-20&amp;arch=x86_64&#x000A;enabled=0&#x000A;gpgcheck=0&#x000A;metadata_expire=1h&#x000A;&#x000A;[fedora-20-updates]&#x000A;name=Fedora 20 updates x86_64&#x000A;metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-released-f20&amp;arch=x86_64&#x000A;enabled=0&#x000A;gpgcheck=0&#x000A;metadata_expire=1h&#x000A;&#x000A;[fedora-20-updates-testing]&#x000A;name=Fedora 20 updates testing x86_64&#x000A;metalink=https://mirrors.fedoraproject.org/metalink?repo=updates-testing-f20&amp;arch=x86_64&#x000A;enabled=0&#x000A;gpgcheck=0&#x000A;metadata_expire=1h&#x000A;EOF&#x000A;</code></pre>

<h3>Build Machine Installation, Configuration</h3>

<p>Next, let&rsquo;s install some needed packages:</p>
<pre class="highlight plaintext"><code>yum -y install --enablerepo rpm-ostree \&#x000A;screen httpd yum-utils \&#x000A;libgsystem \&#x000A;ostree rpm-ostree-autobuilder \&#x000A;binutils nss-altfiles&#x000A;</code></pre>

<p>Then, we need to edit /etc/nsswitch.conf to include <code>altfiles</code>, like this:</p>
<pre class="highlight plaintext"><code>passwd: files altfiles &#x000A;group:  files altfiles&#x000A;</code></pre>

<p>Also, it&rsquo;s necessary (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=1060423">for now</a>) to disable SELinux on the build machine:</p>
<pre class="highlight plaintext"><code>sed -i 's/^SELINUX=.*/SELINUX=disabled/g' /etc/selinux/config &amp;&amp; cat /etc/selinux/config&#x000A;</code></pre>

<p>Now, we&rsquo;ll set up a repository from which our eventual Atomic hosts will fetch upgrades:</p>
<pre class="highlight plaintext"><code>mkdir /srv/rpm-ostree &amp;&amp;&#x000A;cd /srv/rpm-ostree &amp;&amp;&#x000A;mkdir -p repo &amp;&amp;&#x000A;ostree --repo=repo init --mode=archive-z2 &amp;&amp;&#x000A;cat &gt; /etc/httpd/conf.d/rpm-ostree.conf &lt;&lt;EOF&#x000A;DocumentRoot /srv/rpm-ostree&#x000A;&lt;Directory "/srv/rpm-ostree"&gt;&#x000A;Options Indexes FollowSymLinks&#x000A;AllowOverride None&#x000A;Require all granted&#x000A;&lt;/Directory&gt;&#x000A;EOF&#x000A;</code></pre>

<p>Then, we&rsquo;ll add a systemd service file for the rpm-ostree-autobuilder service, enable that service, along with httpd, and finally ensure that our firewall is open to http traffic:</p>
<pre class="highlight plaintext"><code>cat &gt; /etc/systemd/system/rpm-ostree-autobuilder.service &lt;&lt;EOF&#x000A;[Unit]&#x000A;Description=RPM-OSTree autobuilder&#x000A;&#x000A;[Service]&#x000A;WorkingDirectory=/srv/rpm-ostree&#x000A;ExecStart=/usr/bin/rpm-ostree-autobuilder&#x000A;&#x000A;[Install]&#x000A;WantedBy=multi-user.target&#x000A;EOF&#x000A;</code></pre>
<pre class="highlight plaintext"><code>systemctl daemon-reload &amp;&amp;&#x000A;systemctl enable httpd &amp;&amp;&#x000A;systemctl start httpd &amp;&amp;&#x000A;systemctl reload httpd &amp;&amp;&#x000A;systemctl enable rpm-ostree-autobuilder &amp;&amp;&#x000A;systemctl start rpm-ostree-autobuilder &amp;&amp;&#x000A;firewall-cmd --add-service=http &amp;&amp;&#x000A;firewall-cmd --add-service=http --permanent&#x000A;</code></pre>

<p>Now, reboot your build machine to let our SELinux-disabling take effect:</p>
<pre class="highlight plaintext"><code>systemctl reboot&#x000A;</code></pre>

<h3>Tree-Building Time</h3>

<p>Upon reboot, the rpm-ostree-autobuilder service should start, and begin looking, in the <code>/srv/rpm-ostree</code> directory, for a <code>products.json</code> file to define the trees and images to build.</p>

<p>A products.json that corresponds to the initial Project Atomic images is available <a href="https://gist.github.com/jasonbrooks/10749644">in this gist</a>. A products.json that produces multiple images (based on rawhide) is available in Colin Walters&rsquo; <a href="https://github.com/cgwalters/fedora-atomic/blob/master/products.json">Fedora Atomic Initiative repository</a>.</p>

<p>Some notes on products.json:</p>

<ul>
<li><p>The <code>&quot;repo&quot;</code> line of your products.json file should point to the repo directory on your build machine. If you want to use a separate machine to host updates, you can rsync the /srv/rpm-ostree/repo directory on your build machine to a separate server, and set that <code>&quot;repo&quot;</code> value accordingly.</p></li>
<li><p>The <code>&quot;releases&quot;</code> line should include a list of yum repositories that match the names of the repos we configured above (or whatever other repos you want to use).</p></li>
<li><p>The <code>&quot;products&quot;</code> section includes the <code>&quot;packages&quot;</code> specific to a particular image, and a <code>&quot;units&quot;</code> section listing systemd services to start by default.</p></li>
</ul>

<p>The rpm-ostree-autobuilder will periodically check for products.json changes, and build accordingly, but you can spur a new build by running the command </p>
<pre class="highlight plaintext"><code>rm -rf cache/raw/images images/auto cache/packageset*.txt &amp;&amp; echo treecompose | rpm-ostree-autobuilder console&#x000A;</code></pre>

<p>from your /srv/rpm-ostree directory. (that first, <code>rm</code> command is due to a caching bug and ought to be unnecessary before too long)</p>

<p>The ostree assembly process takes a while to complete. You can monitor the treecompose with:</p>
<pre class="highlight plaintext"><code>tail -F /srv/rpm-ostree/tasks/treecompose/treecompose/log*&#x000A;</code></pre>

<p>Eventually, the log will read <q>Complete,</q> and you can monitor the image-building with:</p>
<pre class="highlight plaintext"><code>tail -F /srv/rpm-ostree/tasks/ensure-disk-caches/ensure-disk-caches/output.txt /srv/rpm-ostree/tasks/zdisks/zdisks/output.txt&#x000A;</code></pre>

<p>When that completes, the log will say, <q>Completed compression, renaming to&hellip;</q> and you&rsquo;ll be able to download your image in the tree (where exactly depends on your products.json) under YOURBUILDERHOST/images/auto/&hellip;/latest-qcow2.xz.</p>

<p>The builder produces qcow2 images. You can use the <code>qemu-img</code> tool to convert this image to raw, VDI (VirtualBox), VMDK (VMWare) and VHD (Hyper-V). Here&rsquo;s how you convert from qcow2 to vdi:</p>
<pre class="highlight plaintext"><code>xz -d latest-qcow2.xz &amp;&amp; &#x000A;qemu-img convert -f qcow2 latest-qcow2 -O vdi latest.vdi&#x000A;</code></pre>

<h3>Upgrading, Atomically</h3>

<p>Once you&rsquo;re up and running in your new image, you can fetch updates with the command <code>rpm-ostree upgrade</code>. If you&rsquo;ve followed along with me, step by step, you won&rsquo;t have configured gpg signing, and rpm-ostree will tell you to add <code>gpg-verify=false</code> to your remote configuration. The relevant config file lives at <code>/ostree/repo/config</code>.</p>

<p>Of course, you won&rsquo;t have any upgrades available right out of the gate, but once enough time goes by for new packages to enter Fedora&rsquo;s update repo, or, once you&rsquo;ve added packages to your products.json and run the treecompose command above, you&rsquo;ll be able to pull down these changes with <code>rpm-ostree upgrade</code>, followed by a reboot.</p>

<p>Don&rsquo;t like the changes? You can rollback with <code>rpm-ostree rollback</code>, followed by a reboot.</p>

<h3>Till Next Time</h3>

<p>If you run into trouble following this walkthrough, I’ll be happy to help you get up and running or get pointed in the right direction. Ping me at jbrooks in #atomic on freenode irc or <a href="https://twitter.com/jasonbrooks">@jasonbrooks</a> on Twitter. Also, be sure to check out the <a href="http://ask.projectatomic.io/en/questions/">Project Atomic Q&amp;A site</a>.</p>

<a class="more-link view-article" href="/blog/2014/04/build-your-own-atomic-host-on-fedora-20/">View article &raquo;</a>
</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'>
<li><a href="/blog/tag/atomic/">Atomic</a></li>
<li><a href="/blog/tag/docker/">Docker</a></li>
<li><a href="/blog/tag/fedora/">Fedora</a></li>
</ul>
</div>
</footer>
</article>

<ul class='pagination'>
<li>
<a href="/blog/page=62/">Newer</a>
</li>
<li>
<a href="/blog/page=59/">59</a>
</li>
<li>
<a href="/blog/page=60/">60</a>
</li>
<li>
<a href="/blog/page=61/">61</a>
</li>
<li>
<a href="/blog/page=62/">62</a>
</li>
<li class='active'>
<span>63</span>
</li>
<li>
<a href="/blog/page=64/">64</a>
</li>
<li>
<a href="/blog/page=64/">Older</a>
</li>
</ul>

</section>

</section>

</div>
</section>

</section>
</div>
<div class='row'>
<div class='col-md-offset-3 col-md-9 col-lg-offset-2 col-lg-10' id='footer'>
<footer>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="https://fedoraproject.org/wiki/Legal:PrivacyPolicy">Privacy Policy</a></li>
</ul>

&copy; 2014&ndash;2021 Project Atomic. Sponsored by Red Hat, Inc.
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://tracker.osci.io/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 4]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://tracker.osci.io/piwik/piwik.php?idsite=4" style="border:0;" alt="" /></p></noscript>
</footer>
</div>
</div>

</section>

<script src="/javascripts/application.js?1633620584" type="text/javascript"></script>


</body>
</html>

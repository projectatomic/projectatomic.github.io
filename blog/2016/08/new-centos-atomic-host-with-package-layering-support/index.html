<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8 lt-ie7" lang="en-us"> <![endif]-->
<!--[if IE 7]> <html class="no-js lt-ie10 lt-ie9 lt-ie8" lang="en-us"> <![endif]-->
<!--[if IE 8]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if IE 9]> <html class="no-js lt-ie10 lt-ie9" lang="en-us"> <![endif]-->
<!--[if lt IE 10]> <html class="no-js lt-ie10" lang="en-us"> <![endif]-->
<!--[if !IE]> > <![endif]-->
<html class='no-js' lang='en'>
<!-- <![endif] -->
<head>
<title>
New CentOS Atomic Host with Package Layering Support &mdash;
Project Atomic
</title>
<meta charset='utf-8'>
<meta content='' name='description'>
<meta content='Jason Brooks' name='author'>
<meta content='initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width' name='viewport'>
<link href='/blog/feed.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<!-- Open Graph (FB / G+) -->
<meta content='article' property='og:type'>
<meta content='New CentOS Atomic Host with Package Layering Support' property='og:title'>
<meta content='Last week, the CentOS Atomic SIG released an updated version of CentOS Atomic Host (tree version 7.20160818), featuring support for rpm-ostree package layering.&#x000A;&#x000A;CentOS Atomic Host is available as a VirtualBox or libvirt-formatted Vagrant box; or as an installable ISO, qcow2, or Amazon Machine image. Check out the CentOS wiki for download links and installation instructions, or read on to learn more about what’s new in this release.' property='og:description'>
<meta content='http://www.projectatomic.io/blog/2016/08/new-centos-atomic-host-with-package-layering-support/' property='og:url'>
<meta content='2016-08-30T18:38:04Z' property='article:published_time'>
<meta content='jbrooks' property='article:author:username'>
<meta content='centos' property='article:tag'>
<link href='/blog/tag/centos.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<meta content='rpm-ostree' property='article:tag'>
<link href='/blog/tag/rpm-ostree.xml' rel='alternate' title='Atom feed' type='application/atom+xml'>
<!-- Twitter card -->
<meta content='summary' name='twitter:card'>
<meta content='New CentOS Atomic Host with Package Layering Support' name='twitter:title'>
<meta content='Last week, the CentOS Atomic SIG released an updated version of CentOS Atomic Host (tree version 7.20160818), featuring support for rpm-ostree package layering.&#x000A;&#x000A;CentOS Atomic Host is available as a VirtualBox or libvirt-formatted Vagrant box; or as an installable ISO, qcow2, or Amazon Machine image. Check out the CentOS wiki for download links and installation instructions, or read on to learn more about what’s new in this release.' name='twitter:description'>

<link href='/images/favicon.ico' rel='shortcut icon'>
<link href='/images/apple-touch-icon-precomposed.png' rel='apple-touch-icon-precomposed'>
<link href='/images/apple-touch-icon-57x57-precomposed.png' rel='apple-touch-icon-precomposed' sizes='57x57'>
<link href='/images/apple-touch-icon-72x72-precomposed.png' rel='apple-touch-icon-precomposed' sizes='72x72'>
<link href='/images/apple-touch-icon-114x114-precomposed.png' rel='apple-touch-icon-precomposed' sizes='114x114'>
<link href='/blog/feed.xml' rel='alternate' title='Project Atomic' type='application/atom+xml'>
<link href="/stylesheets/application.css?1633620577" rel="stylesheet" type="text/css" />
<link href="/stylesheets/print.css?1633620578" rel="stylesheet" type="text/css" media="print" />
</head>
<body class=' blog blog_2016 blog_2016_08 blog_2016_08_new-centos-atomic-host-with-package-layering-support blog_2016_08_new-centos-atomic-host-with-package-layering-support_index source-md'>
<section class='container' id='page-wrap'>
<div class='row'>
<div class='col-md-3 col-lg-2' id='sidebar'>
<div id='nav-primary'>
<nav class='navbar navbar-default' role='navigation'>
<div class='navbar-header'>
<button class='navbar-toggle' data-target='.navbar-ex1-collapse' data-toggle='collapse'>
<span class='sr-only'>
Toggle navigation
</span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
<span class='icon-bar'></span>
</button>
<a class='navbar-brand' href='/'>
Project Atomic
</a>
</div>
<div class='collapse navbar-collapse navbar-ex1-collapse'>
<ul class='nav navbar-nav'>
<li><a class="get-started" href="/download">Get Started</a></li>
<li><a class="documentation" href="/docs">Documentation</a></li>
<li><a class="developer-community" href="/community">Developer Community</a></li>
<li><a class="talks" href="/community/talks">Talks</a></li>
<li><a class="on-github" href="https://github.com/projectatomic/">On GitHub</a></li>
<li><a class="blog" href="/blog">Blog</a></li>
<li><a class="twitter" href="http://www.twitter.com/projectatomic">Twitter</a></li>
<li><a class="rss" href="../../../feed.xml">RSS</a></li>
</ul>
</div>
</nav>

</div>

</div>
<section class='col-lg-10 col-md-9 container' id='content'>
<!--[if lt IE 7]>
<p class="chromeframe">You are using an outdated browser.
<a href="http://browsehappy.com/">Upgrade your browser today</a> or
<a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
<![endif]-->
<section class='blog-post-page row'>
<div class='col-md-12'>
<article class='post hentry'>
<header class='post-header'>
<h2 class='post-title entry-title'>
New CentOS Atomic Host with Package Layering Support
</h2>
<p class='post-meta'>
<span class='byline'>
by
</span>
<span class='author vcard'>
<a href="/blog/author/jbrooks/">Jason Brooks</a>
</span>
&ndash;
<time class='published' datetime='2016-08-30T18:38:04Z'>
Tuesday 30 August 2016
</time>
</p>
</header>
<section class='post-content entry-content'>
<p>Last week, the CentOS Atomic SIG <a href="https://seven.centos.org/2016/08/announcing-a-new-release-of-centos-atomic-host-2/">released</a> an updated version of CentOS Atomic Host (tree version 7.20160818), featuring support for rpm-ostree package layering.</p>

<p>CentOS Atomic Host is available as a VirtualBox or libvirt-formatted Vagrant box; or as an installable ISO, qcow2, or Amazon Machine image. Check out the <a href="https://wiki.centos.org/SpecialInterestGroup/Atomic/Download">CentOS wiki</a> for download links and installation instructions, or read on to learn more about what’s new in this release.</p>

<p></p>

<p>CentOS Atomic Host includes these core component versions:</p>

<ul>
<li>docker-1.10.3-46.el7.centos.10.x86_64</li>
<li>kubernetes-1.2.0-0.13.gitec7364b.el7.x86_64</li>
<li>kernel-3.10.0-327.28.2.el7.x86_64</li>
<li>atomic-1.10.5-7.el7.x86_64</li>
<li>flannel-0.5.3-9.el7.x86_64</li>
<li>ostree-2016.7-2.atomic.el7.x86_64</li>
<li>etcd-2.3.7-2.el7.x86_64</li>
<li>cloud-init-0.7.5-10.el7.centos.1.x86_64</li>
</ul>

<h3>Package Layering</h3>

<p>Using the command rpm-ostree pkg-add, it’s now possible to layer new packages into an installed image that persist across reboots and upgrades, a topic that <a href="https://github.com/jlebon">Jonathan Lebon</a> <a href="http://www.projectatomic.io/blog/2016/07/hacking-and-extending-atomic-host/">covered in some detail</a> in a post last month.</p>

<p>For instance, if I wanted to install ansible on an atomic host:</p>
<pre class="highlight plaintext"><code># rpm-ostree pkg-add epel-release&#x000A;# reboot&#x000A;# rpm-ostree pkg-add ansible&#x000A;# reboot&#x000A;# ansible --version&#x000A;ansible 2.1.1.0&#x000A;  config file = /etc/ansible/ansible.cfg&#x000A;  configured module search path = Default w/o overrides&#x000A;</code></pre>

<p>I first installed the <code>epel-release</code> package because ansible lives in EPEL. The intermediate reboot was required to boot into the new EPEL-i-fied tree. I could have instead added the repo file for EPEL in my <code>/etc/yum.repos.d/</code> directory, and skipped the extra install and reboot operations. To learn about the work going on to make package layering more <q>live,</q> check out <a href="https://bugzilla.gnome.org/show_bug.cgi?id=767977">this issue</a>.</p>

<p>There are limitations to package layering. For instance, I&rsquo;ve <a href="http://www.projectatomic.io/blog/2015/01/running-ovirt-guest-agent-as-privileged-container/">written in the past</a> about running oVirt&rsquo;s guest agent (which is not part of the standard atomic host image) in a docker container. Package layering won&rsquo;t work for this scenario, because installing packages which contain files owned by users other than root is currently not supported:</p>
<pre class="highlight plaintext"><code># rpm-ostree pkg-add ovirt-guest-agent-common&#x000A;notice: pkg-add is a preview command and subject to change.&#x000A;&#x000A;Downloading metadata: [================================================] 100%&#x000A;Resolving dependencies... done&#x000A;Will download: 3 packages (209.2 kB)&#x000A;&#x000A;  Downloading from epel: [=============================================] 100%&#x000A;&#x000A;  Downloading from base: [=============================================] 100%&#x000A;&#x000A;Importing: [===================                                        ]  33%&#x000A;error: Unpacking ovirt-guest-agent-common-1.0.12-3.el7.noarch: Non-root ownership currently unsupported: path "/var/log/ovirt-guest-agent" marked as ovirtagent:ovirtagent)&#x000A;</code></pre>

<h3>CentOS Atomic Host Alpha</h3>

<p>While it&rsquo;s not yet possible to pkg-add packages with files owned by users other than root on the current CentOS Atomic Host release, the host&rsquo;s <a href="https://wiki.centos.org/SpecialInterestGroup/Atomic/Devel">Alpha stream </a> includes a newer version of rpm-ostree that works just fine with these sorts of packages.</p>

<p>Apart from its newer rpm-ostree version, the Alpha release of CentOS Atomic Host now features a <a href="https://lists.projectatomic.io/projectatomic-archives/atomic-devel/2016-August/msg00104.html">much slimmer package list</a>, as the project begins to move toward containerization or package layering for system components such as kubernetes, flannel, and etcd.</p>

</section>
<footer class='post-meta'>
<div class='tags'>
Tags:
<ul class='taglist'>
<li><a href="/blog/tag/centos/">centos</a></li>
<li><a href="/blog/tag/rpm-ostree/">rpm-ostree</a></li>
</ul>
</div>

<p>
<small>Share this post:</small>
<span class='btn-group' id='social_share'>
<a class='btn btn-default btn-xs' href='http://twitter.com/share?text=yourtext&amp;url=http://www.projectatomic.io/blog/2016/08/new-centos-atomic-host-with-package-layering-support/' role='button' title='Twitter'>
<i class='fa fa-twitter'></i>
Twitter
</a>
<a class='btn btn-default btn-xs' href='http://www.facebook.com/sharer.php?u=http://www.projectatomic.io/blog/2016/08/new-centos-atomic-host-with-package-layering-support/' role='button' title='Facebook'>
<i class='fa fa-facebook'></i>
Facebook
</a>
<a class='btn btn-default btn-xs' href='https://plus.google.com/share?url=http://www.projectatomic.io/blog/2016/08/new-centos-atomic-host-with-package-layering-support/' role='button' title='Google'>
<i class='fa fa-google-plus'></i>
Google+
</a>
</span>
</p>

</footer>
</article>

<section id='blog-comments'></section>
</div>
</section>

</section>
</div>
<div class='row'>
<div class='col-md-offset-3 col-md-9 col-lg-offset-2 col-lg-10' id='footer'>
<footer>
<hr class='visible-print'>
<ul class='footer-nav-list'>
<li><a target="_blank" href="https://fedoraproject.org/wiki/Legal:PrivacyPolicy">Privacy Policy</a></li>
</ul>

&copy; 2014&ndash;2021 Project Atomic. Sponsored by Red Hat, Inc.
        <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://tracker.osci.io/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 4]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
<noscript><p><img src="https://tracker.osci.io/piwik/piwik.php?idsite=4" style="border:0;" alt="" /></p></noscript>
</footer>
</div>
</div>

</section>

<script src="/javascripts/application.js?1633620584" type="text/javascript"></script>


</body>
</html>
